# VPN WireGuard

**Secure VPN server for remote access to your LLM infrastructure**

Dockerized WireGuard VPN server with automatic client configuration, QR code generation, and easy client management. Perfect for securely accessing your distributed LLM servers from anywhere.

## What It Does

Provides a production-ready WireGuard VPN server that lets you securely connect to your LLM infrastructure from remote locations. Automatically generates client configurations with QR codes for easy mobile setup.

## Why You Need This

**Secure Remote Access** - Safely access your LLM servers from anywhere
**Easy Client Setup** - QR codes for instant mobile configuration
**Zero Config** - Auto-detects public IP and network settings
**Production Ready** - Persistent storage, automatic restarts
**Multi-Platform** - Works with desktop and mobile clients

## Prerequisites

- Docker and Docker Compose installed
- Server with a public IP address
- UDP port 51820 (or custom port) open in firewall

## Quick Start

```bash
# 1. Clone and navigate
git clone <repository-url>
cd vpn-wireguard

# 2. Configure (optional)
cp .env.example .env
nano .env  # Customize if needed

# 3. Start VPN server
docker-compose up -d

# 4. View client config and QR code
docker-compose logs

# 5. Download client config
docker cp wireguard:/etc/wireguard/client1.conf ./client1.conf
```

The logs will show:
- **QR code** for mobile setup
- **Configuration file** for desktop clients
- **Server status** and connection info

## Configuration

Edit the `.env` file or set environment variables in `docker-compose.yml`:

| Variable | Default | Description |
|----------|---------|-------------|
| `SERVER_PUB_IP` | `auto` | Server's public IP (auto-detected if set to 'auto') |
| `SERVER_PUB_NIC` | `eth0` | Public network interface name |
| `SERVER_WG_NIC` | `wg0` | WireGuard interface name |
| `SERVER_WG_IPV4` | `10.66.66.1` | Server's WireGuard IPv4 address |
| `SERVER_WG_IPV6` | `fd42:42:42::1` | Server's WireGuard IPv6 address |
| `SERVER_PORT` | `51820` | WireGuard listening port (UDP) |
| `CLIENT_DNS_1` | `1.1.1.1` | Primary DNS server for clients |
| `CLIENT_DNS_2` | `1.0.0.1` | Secondary DNS server for clients |
| `ALLOWED_IPS` | `0.0.0.0/0,::/0` | Traffic to route through VPN |
| `CLIENT_NAME` | `client1` | Name of the initial client |

### AllowedIPs Configuration

- **Full tunnel (all traffic through VPN):** `0.0.0.0/0,::/0` (default)
- **Split tunnel (only specific networks):** `10.0.0.0/8,192.168.0.0/16`

## Usage

### Add a New Client

```bash
# Quick method (recommended)
docker exec -it wireguard /bin/bash -c "/add-client.sh client2"

# Interactive method
docker exec -it wireguard /bin/bash
/add-client.sh client2
```

### View Client Configuration

```bash
# View configuration
docker exec wireguard cat /etc/wireguard/client2.conf

# Get QR code for mobile
docker exec wireguard bash -c "cat /etc/wireguard/client2.conf | qrencode -t ansiutf8"

# Download configuration
docker cp wireguard:/etc/wireguard/client2.conf ./client2.conf
```

### List All Clients

```bash
docker exec wireguard ls -la /etc/wireguard/*.conf
```

## Client Setup

### Desktop (Linux/macOS/Windows)

1. Install WireGuard client from [wireguard.com/install](https://www.wireguard.com/install/)
2. Import the configuration file
3. Activate the connection

### Mobile (iOS/Android)

1. Install WireGuard app from App Store or Google Play
2. Scan the QR code shown in the logs or generated by the helper script
3. Activate the connection

## Monitoring

### View WireGuard Status

```bash
docker exec wireguard wg show
```

### View Container Logs

```bash
docker-compose logs -f
```

### Check Connected Clients

```bash
docker exec wireguard wg show wg0
```

## Use Cases

### Remote Access to LLM Servers
Access your Ollama, vLLM, or other LLM servers securely from anywhere:
```bash
# Connect via VPN
# Then access your LLM servers
curl http://192.168.1.10:11434/api/tags  # Ollama server
curl http://192.168.1.11:4000/health     # LiteLLM gateway
```

### Multi-Location Deployments
Connect distributed LLM infrastructure across multiple locations into a single private network.

### Development from Anywhere
Work on your LLM projects remotely with full access to your local infrastructure.

## Troubleshooting

### Container won't start
```bash
# Check kernel module
lsmod | grep wireguard

# View logs
docker-compose logs
```

### Can't connect to VPN
```bash
# Open firewall port
sudo ufw allow 51820/udp

# Verify public IP
docker exec wireguard cat /etc/wireguard/params | grep SERVER_PUB_IP

# Check WireGuard status
docker exec wireguard wg show
```

### No internet through VPN
```bash
# Check IP forwarding
docker exec wireguard sysctl net.ipv4.ip_forward

# Verify iptables
docker exec wireguard iptables -t nat -L POSTROUTING
```

## Persistence

Configuration stored in `./config` directory (mounted to `/etc/wireguard`). All settings persist across container restarts.

## Security Notes

- All private keys are stored with 600 permissions
- Configuration files are stored with 600 permissions
- Pre-shared keys are used for additional security
- The container requires NET_ADMIN capability for network configuration

## Updating

To update the WireGuard server:

```bash
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

Your configuration in `./config` will be preserved.

## Removing WireGuard

To completely remove WireGuard and all configurations:

```bash
docker-compose down
sudo rm -rf ./config
```

## Advanced Usage

### Custom Docker Compose Configuration

You can modify [docker-compose.yml](docker-compose.yml) to:
- Change network settings
- Add additional volumes
- Modify restart policies
- Set resource limits

### Using an Existing Configuration

If you already have WireGuard configuration files, place them in `./config` directory before starting the container.

## Integration with LLM Infrastructure

Works seamlessly with all LLM-Infrastructure components:

```bash
# After connecting to VPN, access your infrastructure
# Monitor servers
streamlit run multi-server-monitoring-dashboard/app.py

# Access LiteLLM gateway
curl http://vpn-server-ip:4000/v1/models

# Connect to Ollama servers
ollama list --host http://vpn-server-ip:11434
```

## License

MIT License - see [LICENSE](../LICENSE) for details

Based on [angristan/wireguard-install](https://github.com/angristan/wireguard-install)

---

**Part of the [LLM Infrastructure](../) toolkit**
Secure remote access for your local LLM infrastructure.
